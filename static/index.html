<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>САМОСВАЛ - CI/CD Платформа</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <!-- Страница входа -->
    <div id="login-page" class="page active">
        <div class="login-container">
            <div class="login-box">
                <h1>САМОСВАЛ</h1>
                <p class="subtitle">CI/CD Платформа</p>
                <form id="login-form">
                    <div class="form-group">
                        <label for="username">Имя пользователя</label>
                        <input type="text" id="username" name="username" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Пароль</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Войти</button>
                    <div id="login-error" class="error-message"></div>
                </form>
                <div class="test-accounts">
                    <p><strong>Тестовые аккаунты:</strong></p>
                    <p>admin / admin123</p>
                    <p>operator / operator123</p>
                    <p>developer / developer123</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard для разработчика -->
    <div id="developer-dashboard" class="page">
        <nav class="navbar">
            <div class="nav-brand">САМОСВАЛ</div>
            <div class="nav-user">
                <span id="nav-username"></span>
                <button class="btn btn-sm" onclick="logout()">Выйти</button>
            </div>
        </nav>
        <div class="container">
            <h2>Панель разработчика</h2>
            
            <div class="tabs">
                <button class="tab-btn active" data-tab="applications" onclick="showDeveloperTab('applications')">Мои заявки</button>
                <button class="tab-btn" data-tab="deployments" onclick="showDeveloperTab('deployments')">Развёртывания</button>
            </div>

            <!-- Мои заявки -->
            <div id="dev-applications-tab" class="tab-content active">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0;">Мои заявки на развёртывание</h3>
                    <button class="btn btn-primary" onclick="showNewApplicationForm()" id="new-app-btn">+ Создать заявку</button>
                </div>
                
                <!-- Форма создания заявки (скрыта по умолчанию) -->
                <div id="new-application-form-container" style="display: none; margin-bottom: 30px;">
                    <div class="form-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h4 style="margin: 0;">Создать новую заявку</h4>
                            <button type="button" class="btn btn-sm" onclick="closeNewApplicationForm()" style="background: #e2e8f0; color: #4a5568;">✕ Закрыть</button>
                        </div>
                        <form id="new-application-form">
                            <div class="form-group">
                                <label>Git репозиторий</label>
                                <input type="url" id="git-repo" placeholder="https://github.com/user/repo.git" required>
                            </div>
                            <div class="form-group">
                                <label>Ветка</label>
                                <input type="text" id="branch" placeholder="main" required>
                            </div>
                            <div class="form-group">
                                <label>Имя образа</label>
                                <input type="text" id="image-name" placeholder="my-service" required>
                            </div>
                            <div class="form-group">
                                <label>Базовый Docker образ</label>
                                <input type="text" id="base-image" placeholder="alpine:latest" required>
                            </div>
                            <div class="form-group">
                                <label>Команды RUN (по одной на строку)</label>
                                <textarea id="run-commands" rows="5" placeholder="pip install -r requirements.txt&#10;npm install"></textarea>
                            </div>
                            <div class="form-group">
                                <label>ENTRYPOINT</label>
                                <input type="text" id="entrypoint" placeholder="python app.py">
                            </div>
                            <button type="submit" class="btn btn-primary">Создать заявку</button>
                        </form>
                    </div>
                </div>
                
                <div id="applications-list"></div>
            </div>

            <!-- Развёртывания -->
            <div id="dev-deployments-tab" class="tab-content">
                <h3>Мои развёртывания</h3>
                <div id="deployments-list"></div>
            </div>
        </div>
    </div>

    <!-- Dashboard для оператора -->
    <div id="operator-dashboard" class="page">
        <nav class="navbar">
            <div class="nav-brand">САМОСВАЛ</div>
            <div class="nav-user">
                <span id="nav-username-op"></span>
                <button class="btn btn-sm" onclick="logout()">Выйти</button>
            </div>
        </nav>
        <div class="container">
            <h2>Панель оператора</h2>
            
            <div class="tabs">
                <button class="tab-btn active" onclick="showOperatorTab('applications')">Заявки</button>
                <button class="tab-btn" onclick="showOperatorTab('images')">Образы</button>
                <button class="tab-btn" onclick="showOperatorTab('deployments')">Развёртывания</button>
                <button class="tab-btn" onclick="showOperatorTab('metrics')">Метрики</button>
            </div>

            <!-- Заявки -->
            <div id="op-applications-tab" class="tab-content active">
                <h3>Заявки на развёртывание</h3>
                <div id="operator-applications-list"></div>
            </div>

            <!-- Образы -->
            <div id="op-images-tab" class="tab-content">
                <h3>Docker образы</h3>
                <div id="images-list"></div>
            </div>

            <!-- Развёртывания -->
            <div id="op-deployments-tab" class="tab-content">
                <h3>Управление развёртываниями</h3>
                <button class="btn btn-primary" onclick="showCreateDeploymentModal()">Создать развёртывание</button>
                <div id="operator-deployments-list"></div>
            </div>

            <!-- Метрики -->
            <div id="op-metrics-tab" class="tab-content">
                <h3>Метрики системы</h3>
                <div id="metrics-content"></div>
            </div>
        </div>
    </div>

    <!-- Dashboard для администратора -->
    <div id="admin-dashboard" class="page">
        <nav class="navbar">
            <div class="nav-brand">САМОСВАЛ</div>
            <div class="nav-user">
                <span id="nav-username-admin"></span>
                <button class="btn btn-sm" onclick="logout()">Выйти</button>
            </div>
        </nav>
        <div class="container">
            <h2>Панель администратора</h2>
            
            <div class="tabs">
                <button class="tab-btn active" onclick="showAdminTab('users')">Пользователи</button>
                <button class="tab-btn" onclick="showAdminTab('audit')">Аудит</button>
            </div>

            <!-- Пользователи -->
            <div id="admin-users-tab" class="tab-content active">
                <h3>Управление пользователями</h3>
                <button class="btn btn-primary" onclick="showCreateUserModal()">Добавить пользователя</button>
                <div id="users-list"></div>
            </div>

            <!-- Аудит -->
            <div id="admin-audit-tab" class="tab-content">
                <h3>Журнал аудита</h3>
                <div id="audit-logs"></div>
            </div>
        </div>
    </div>

    <!-- Модальные окна -->
    <div id="modal-overlay" class="modal-overlay" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>

